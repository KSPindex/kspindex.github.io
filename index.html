<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to the IndexSpace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, updateDoc, increment, setDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // Global variables for Firebase config (provided by Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        let db;
        let auth;
        let userId;

        // Smooth scroll function
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const headerOffset = document.querySelector('header').offsetHeight;
                    const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - headerOffset;
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: "smooth"
                    });
                }
            });
        });

        document.querySelector('main a[href^="#"]').addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                const headerOffset = document.querySelector('header').offsetHeight;
                const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                const offsetPosition = elementPosition - headerOffset;
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        });

        // Firebase Initialization and Click Tracking Logic
        window.onload = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in anonymously if no initial auth token, otherwise use custom token
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                userId = auth.currentUser?.uid || crypto.randomUUID();
                document.getElementById('userIdDisplay').textContent = `사용자 ID: ${userId}`;

                const clickCountRef = doc(db, `artifacts/${appId}/public/data/site_analytics/indexspace_clicks`);
                let currentClicks = 0;

                // Fetch initial click count
                try {
                    const docSnap = await getDoc(clickCountRef);
                    if (docSnap.exists()) {
                        currentClicks = docSnap.data().count || 0;
                    } else {
                        // If document doesn't exist, create it with initial count 0
                        await setDoc(clickCountRef, { count: 0 });
                    }
                } catch (error) {
                    console.error("Error fetching initial click count:", error);
                    currentClicks = 0; // Fallback if fetch fails
                }
                document.getElementById('clickCountDisplay').textContent = `클릭 수: ${currentClicks}명`;

                // Click event listener for the rectangle
                const clickTrackerDiv = document.getElementById('clickTracker');
                if (clickTrackerDiv) {
                    clickTrackerDiv.addEventListener('click', async () => {
                        try {
                            await updateDoc(clickCountRef, {
                                count: increment(1)
                            });
                            currentClicks++; // Optimistically update UI
                            document.getElementById('clickCountDisplay').textContent = `클릭 수: ${currentClicks}명`;
                        } catch (error) {
                            console.error("Error updating click count:", error);
                        }
                    });
                } else {
                    console.error("Click tracker element not found.");
                }

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                document.getElementById('userIdDisplay').textContent = `사용자 ID: 오류 발생`;
                document.getElementById('clickCountDisplay').textContent = `클릭 수: 로딩 실패`;
            }
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* 어두운 회색 또는 검은색 */
            color: #e0e0e0; /* 밝은 회색 텍스트 */
            min-height: 100vh;
        }
        /* 색상 팔레트 (Brilliant Blues 기반) - 어두운 배경에 맞게 조정 */
        .primary-blue { color: #007BFF; }
        .secondary-blue { color: #50AEFF; }
        .accent-teal { color: #08C5BA; }
        .bg-primary-blue { background-color: #007BFF; }
        .bg-secondary-blue { background-color: #50AEFF; }
        .bg-accent-teal { background-color: #08C5BA; }
        .text-primary-blue { color: #007BFF; }
        .text-secondary-blue { color: #50AEFF; }
        .text-accent-teal { color: #08C5BA; }
        .hover\:text-highlight-yellow:hover { color: #FFD700; }
        .bg-dark-body { background-color: #1a1a1a; } /* 검은색 배경 */
        .text-light-gray { color: #e0e0e0; } /* 밝은 텍스트 */
        .text-muted-light-gray { color: #a0a0a0; } /* 뮤트된 밝은 텍스트 */
    </style>
</head>
<body class="bg-dark-body text-light-gray">
    <header class="bg-primary-blue text-white py-4 sticky top-0 z-50 shadow-md">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center px-4">
            <a href="#home" class="text-3xl font-bold mb-2 md:mb-0 hover:text-highlight-yellow transition duration-300">나의 발표함</a>
            <nav>
                <ul class="flex flex-wrap justify-center space-x-4 text-lg">
                    <li><a href="#home" class="hover:text-highlight-yellow transition duration-300">홈</a></li>
                    <li><a href="#contact" class="hover:text-highlight-yellow transition duration-300">연락처</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section id="home" class="mb-12 min-h-screen flex items-center justify-center text-center bg-gradient-to-br from-[#000000] to-[#333333] text-white rounded-lg shadow-lg p-8">
            <div>
                <h2 class="text-6xl md:text-7xl font-extrabold mb-6 tracking-tight">Welcome to the IndexSpace</h2>
                <p class="text-xl md:text-2xl mb-8 leading-relaxed text-gray-200">
                    만나서 반갑습니다! 이곳은 KSP가 직접 만들고 관리하는 특별한 공간입니다.<br>
                    다양한 아이디어와 프로젝트, 그리고 제가 탐구한 흥미로운 이야기들을<br>
                    여러분과 함께 나누기 위해 이 공간을 열었습니다.<br>
                    아직은 시작 단계이지만, 앞으로 저의 성장과 함께<br>
                    새로운 내용들로 가득 채워질 예정이니 많은 기대 부탁드립니다.<br>
                    궁금한 점이나 나누고 싶은 이야기가 있다면 언제든지 환영합니다.<br>
                    이곳에서 여러분에게 유익하고 즐거운 경험을 선사할 수 있기를 바랍니다.<br>
                    저의 작은 우주에 오신 것을 다시 한번 환영합니다!<br>
                    함께 새로운 지식과 영감을 탐험해 보아요.<br>
                    방문해 주셔서 진심으로 감사합니다.
                </p>
                <p class="text-lg text-gray-400 mt-10">KSP가 썼음</p>

                <div id="clickTracker" class="bg-accent-teal text-white py-6 px-8 mt-12 rounded-xl shadow-lg cursor-pointer hover:bg-[#06A29A] transition duration-300 transform hover:scale-105">
                    <p class="text-xl md:text-2xl font-bold">이 사각형을 클릭해서 이 사이트에 접속함을 알리세요!</p>
                </div>
                <p id="clickCountDisplay" class="text-lg text-gray-400 mt-4">클릭 수: 로딩 중...</p>
                <p id="userIdDisplay" class="text-sm text-gray-500 mt-2">사용자 ID: 로딩 중...</p>
            </div>
        </section>

        <section id="contact" class="mb-12 pt-16">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-semibold text-primary-blue mb-4 text-center">연락처</h2>
                <p class="text-lg text-muted-light-gray mb-6 text-center">
                    궁금한 점이 있으시면 아래 정보를 통해 연락해 주세요.
                </p>
                <div class="text-center py-8">
                    <p class="text-xl font-semibold mb-2">이메일: <a href="mailto:your.email@example.com" class="text-primary-blue hover:underline">your.email@example.com</a></p>
                    <p class="text-xl font-semibold">SNS: arsode8.tot@gmail.com</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-[#212121] text-white py-6 text-center">
        <p>&copy; 2025 나의 발표함. All Rights Reserved.</p>
    </footer>
</body>
</html>
