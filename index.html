<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to the IndexSpace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, updateDoc, increment, setDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // Global variables for Firebase config (provided by Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        let db;
        let auth;
        let userId;

        // Smooth scroll function
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();

                const targetId = this.getAttribute('href');
                if (targetId === '#') {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const headerOffset = document.querySelector('header').offsetHeight;
                    const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: "smooth"
                    });
                }
            });
        });

        // Firebase Initialization and Click Tracking Logic
        window.onload = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in anonymously if no initial auth token, otherwise use custom token
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                userId = auth.currentUser?.uid || crypto.randomUUID();
                document.getElementById('userIdDisplay').textContent = `사용자 ID: ${userId}`;

                const clickCountRef = doc(db, `artifacts/${appId}/public/data/site_analytics/indexspace_clicks`);
                let currentClicks = 0;

                // Fetch initial click count
                try {
                    const docSnap = await getDoc(clickCountRef);
                    if (docSnap.exists()) {
                        currentClicks = docSnap.data().count || 0;
                    } else {
                        // If document doesn't exist, create it with initial count 0
                        await setDoc(clickCountRef, { count: 0 });
                    }
                } catch (error) {
                    console.error("Error fetching initial click count:", error);
                    currentClicks = 0; // Fallback if fetch fails
                }
                document.getElementById('clickCountDisplay').textContent = `클릭 수: ${currentClicks}명`;

                // Click event listener for the entire home section
                const homeSection = document.getElementById('home');
                if (homeSection) {
                    // Ensure click is only counted once per user session
                    let hasClicked = sessionStorage.getItem('indexspace_clicked_this_session');
                    if (!hasClicked) {
                        homeSection.classList.add('cursor-pointer'); // Add cursor pointer to indicate clickability
                        homeSection.addEventListener('click', async () => {
                            try {
                                await updateDoc(clickCountRef, {
                                    count: increment(1)
                                });
                                currentClicks++; // Optimistically update UI
                                document.getElementById('clickCountDisplay').textContent = `클릭 수: ${currentClicks}명`;
                                sessionStorage.setItem('indexspace_clicked_this_session', 'true'); // Mark as clicked
                                homeSection.classList.remove('cursor-pointer'); // Remove cursor after click
                            } catch (error) {
                                console.error("Error updating click count:", error);
                            }
                        }, { once: true }); // Ensure it only fires once
                    }
                } else {
                    console.error("Home section element not found for click tracking.");
                }

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                document.getElementById('userIdDisplay').textContent = `사용자 ID: 오류 발생`;
                document.getElementById('clickCountDisplay').textContent = `클릭 수: 로딩 실패`;
            }
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* 검은색 배경 */
            color: #ffffff; /* 흰색 텍스트 */
            min-height: 100vh;
        }
        /* 흑백/회색 테마에 맞게 색상 조정 */
        .bg-primary-dark { background-color: #1a1a1a; } /* 헤더/푸터 등 */
        .bg-section-dark { background-color: #2a2a2a; } /* 섹션 배경 */
        .text-light { color: #ffffff; } /* 기본 밝은 텍스트 */
        .text-muted-light { color: #aaaaaa; } /* 뮤트된 밝은 텍스트 */
        .border-thin-white { border: 1px solid rgba(255, 255, 255, 0.3); } /* 얇은 흰색 테두리 */
        .hover\:text-accent-white:hover { color: #ffffff; } /* 호버 시 흰색 강조 */
        .shadow-dark { box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1); } /* 밝은 그림자 */

        /* 메인 섹션 그라데이션 */
        .bg-gradient-home {
            background-image: linear-gradient(to bottom right, #000000, #333333);
        }
    </style>
</head>
<body class="bg-black text-light">
    <header class="bg-primary-dark text-light py-4 sticky top-0 z-50 shadow-md">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center px-4">
            <a href="#home" class="text-3xl font-bold mb-2 md:mb-0 hover:text-accent-white transition duration-300">나의 발표함</a>
            <nav>
                <ul class="flex flex-wrap justify-center space-x-4 text-lg">
                    <li><a href="#home" class="hover:text-accent-white transition duration-300">홈</a></li>
                    <li><a href="#contact" class="hover:text-accent-white transition duration-300">연락처</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section id="home" class="mb-12 min-h-screen flex items-center justify-center text-center bg-gradient-home text-light rounded-lg shadow-dark p-8 border-thin-white">
            <div>
                <h2 class="text-6xl md:text-7xl font-extrabold mb-6 tracking-tight">Welcome to the IndexSpace</h2>
                <p class="text-xl md:text-2xl mb-8 leading-relaxed text-muted-light">
                    만나서 반갑습니다! 이곳은 KSP가 직접 만들고 관리하는 특별한 공간입니다.<br>
                    다양한 아이디어와 프로젝트, 그리고 제가 탐구한 흥미로운 이야기들을<br>
                    여러분과 함께 나누기 위해 이 공간을 열었습니다.<br>
                    아직은 시작 단계이지만, 앞으로 저의 성장과 함께<br>
                    새로운 내용들로 가득 채워질 예정이니 많은 기대 부탁드립니다.<br>
                    궁금한 점이나 나누고 싶은 이야기가 있다면 언제든지 환영합니다.<br>
                    이곳에서 여러분에게 유익하고 즐거운 경험을 선사할 수 있기를 바랍니다.<br>
                    저의 작은 우주에 오신 것을 다시 한번 환영합니다!<br>
                    함께 새로운 지식과 영감을 탐험해 보아요.<br>
                    방문해 주셔서 진심으로 감사합니다.
                </p>
                <p class="text-lg text-gray-500 mt-10">KSP가 썼음</p>

                <div class="mt-12">
                    <p id="clickCountDisplay" class="text-2xl font-bold text-white">클릭 수: 로딩 중...</p>
                    <p class="text-base text-gray-500 mt-2">이 페이지를 클릭하면 방문 기록이 남습니다.</p>
                    <p id="userIdDisplay" class="text-sm text-gray-600 mt-2">사용자 ID: 로딩 중...</p>
                </div>
            </div>
        </section>

        <section id="contact" class="mb-12 pt-16">
            <div class="bg-section-dark rounded-lg shadow-dark p-6 border-thin-white">
                <h2 class="text-3xl font-semibold text-light mb-4 text-center">연락처</h2>
                <p class="text-lg text-muted-light mb-6 text-center">
                    궁금한 점이 있으시면 아래 정보를 통해 연락해 주세요.
                </p>
                <div class="text-center py-8">
                    <p class="text-xl font-semibold mb-2">이메일: <a href="mailto:your.email@example.com" class="text-white hover:underline">your.email@example.com</a></p>
                    <p class="text-xl font-semibold">SNS: @your_social_media (예정)</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-primary-dark text-white py-6 text-center">
        <p>&copy; 2025 나의 발표함. All Rights Reserved.</p>
    </footer>
</body>
</html>
